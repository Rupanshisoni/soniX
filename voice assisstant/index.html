<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>SONIX ‚Äì AI Voice Assistant</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />

  <style>
    * {
      box-sizing: border-box;
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
    }

    body {
      margin: 0;
      padding: 0;
      min-height: 100vh;
      display: flex;
      align-items: center;
      justify-content: center;
      background: radial-gradient(circle at top, #1d4ed8 0, #020617 45%, #000 100%);
      color: #e5e7eb;
    }

    .shell {
      width: 100%;
      max-width: 950px;
      padding: 16px;
    }

    .container {
      background: rgba(15, 23, 42, 0.96);
      border-radius: 18px;
      padding: 18px 18px 20px;
      box-shadow: 0 24px 56px rgba(0, 0, 0, 0.7);
      border: 1px solid rgba(148, 163, 184, 0.18);
      backdrop-filter: blur(10px);
    }

    .header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      gap: 10px;
      margin-bottom: 16px;
      flex-wrap: wrap;
    }

    .brand {
      display: flex;
      align-items: center;
      gap: 10px;
    }

    .logo-circle {
      width: 40px;
      height: 40px;
      border-radius: 999px;
      background: conic-gradient(from 180deg, #22c55e, #0ea5e9, #a855f7, #22c55e);
      display: flex;
      align-items: center;
      justify-content: center;
      box-shadow: 0 0 18px rgba(56, 189, 248, 0.5);
    }

    .logo-circle span {
      background: #020617;
      border-radius: 999px;
      width: 30px;
      height: 30px;
      display: flex;
      align-items: center;
      justify-content: center;
      color: #e5e7eb;
      font-weight: 700;
      font-size: 18px;
    }

    .title-block h1 {
      margin: 0;
      font-size: 22px;
      letter-spacing: 0.08em;
      text-transform: uppercase;
    }

    .title-block .subtitle {
      margin: 0;
      font-size: 12px;
      color: #9ca3af;
    }

    .user-card {
      background: rgba(15, 23, 42, 0.9);
      border-radius: 999px;
      padding: 6px 12px;
      border: 1px solid rgba(148, 163, 184, 0.35);
      display: flex;
      align-items: center;
      gap: 8px;
      font-size: 12px;
    }

    .user-card input {
      background: transparent;
      border: none;
      outline: none;
      color: #e5e7eb;
      font-size: 12px;
      width: 110px;
    }

    .user-card small {
      color: #9ca3af;
    }

    .status-row {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 12px;
      font-size: 12px;
      color: #9ca3af;
      flex-wrap: wrap;
      gap: 8px;
    }

    .status-pill {
      padding: 4px 10px;
      border-radius: 999px;
      background: #020617;
      border: 1px solid rgba(148, 163, 184, 0.5);
      font-size: 11px;
    }

    .status-pill span {
      font-weight: 600;
      color: #22c55e;
    }

    .greeting {
      font-size: 13px;
      color: #cbd5f5;
    }

    .btn-row {
      display: flex;
      justify-content: center;
      gap: 10px;
      margin-bottom: 14px;
      flex-wrap: wrap;
    }

    button {
      border: none;
      padding: 9px 16px;
      border-radius: 999px;
      cursor: pointer;
      font-size: 13px;
      display: inline-flex;
      align-items: center;
      gap: 8px;
      transition: transform 0.1s ease, box-shadow 0.1s ease, filter 0.1s ease,
        background 0.1s ease, color 0.1s ease;
    }

    button.primary {
      background: linear-gradient(135deg, #22c55e, #16a34a);
      color: #022c22;
      box-shadow: 0 14px 30px rgba(34, 197, 94, 0.35);
      font-weight: 600;
    }

    button.primary.listening {
      background: linear-gradient(135deg, #ef4444, #b91c1c);
      box-shadow: 0 14px 30px rgba(248, 113, 113, 0.4);
      color: #fef2f2;
    }

    button.secondary {
      background: #020617;
      color: #e5e7eb;
      border: 1px solid rgba(148, 163, 184, 0.6);
    }

    button:hover {
      transform: translateY(-1px);
      box-shadow: 0 10px 22px rgba(15, 23, 42, 0.8);
      filter: brightness(1.05);
    }

    .mic-dot {
      width: 9px;
      height: 9px;
      border-radius: 999px;
      background: #22c55e;
      box-shadow: 0 0 8px rgba(34, 197, 94, 0.6);
    }

    .mic-dot.listening {
      background: #f97316;
      box-shadow: 0 0 10px rgba(249, 115, 22, 0.9);
    }

    .panels {
      display: grid;
      grid-template-columns: 1.4fr 1fr;
      gap: 14px;
    }

    @media (max-width: 750px) {
      .panels {
        grid-template-columns: 1fr;
      }
    }

    .card {
      background: radial-gradient(circle at top left, #020617 0, #020617 40%, #020617 100%);
      border-radius: 14px;
      padding: 10px;
      border: 1px solid rgba(31, 41, 55, 0.9);
      min-height: 150px;
    }

    .card-header {
      display: flex;
      justify-content: space-between;
      align-items: baseline;
      margin-bottom: 6px;
    }

    .card-header h2 {
      font-size: 15px;
      margin: 0;
      color: #e5e7eb;
    }

    .card-header small {
      font-size: 11px;
      color: #9ca3af;
    }

    .log-area {
      background: #020617;
      border-radius: 10px;
      padding: 8px;
      font-size: 13px;
      max-height: 200px;
      overflow-y: auto;
      border: 1px solid rgba(31, 41, 55, 0.9);
    }

    .log-label {
      color: #9ca3af;
      font-size: 11px;
      margin-bottom: 2px;
    }

    .log-text {
      white-space: pre-wrap;
      color: #e5e7eb;
      margin: 0 0 4px 0;
      font-size: 13px;
    }

    .assistant-text {
      color: #a5b4fc;
    }

    .user-text {
      color: #facc15;
    }

    .help-text {
      margin-top: 6px;
      font-size: 11px;
      color: #9ca3af;
      line-height: 1.5;
    }

    code {
      background: #020617;
      padding: 2px 4px;
      border-radius: 4px;
      font-size: 10px;
      border: 1px solid rgba(31, 41, 55, 0.9);
    }

    .notes-list {
      list-style: none;
      padding: 0;
      margin: 0;
      max-height: 200px;
      overflow-y: auto;
      font-size: 13px;
    }

    .notes-list li {
      background: #020617;
      border-radius: 8px;
      padding: 6px 8px;
      margin-bottom: 6px;
      border: 1px solid rgba(31, 41, 55, 0.9);
      display: flex;
      justify-content: space-between;
      align-items: center;
      gap: 8px;
    }

    .notes-list span.content {
      flex: 1;
    }

    .notes-list button {
      padding: 4px 8px;
      font-size: 11px;
      border-radius: 999px;
      background: #1f2937;
      color: #e5e7eb;
      border: 1px solid #4b5563;
      box-shadow: none;
    }

    .notes-list button:hover {
      filter: brightness(1.08);
    }

    .footer-line {
      margin-top: 10px;
      font-size: 10px;
      text-align: center;
      color: #6b7280;
    }
  </style>
</head>
<body>
  <div class="shell">
    <div class="container">
      <!-- HEADER -->
      <div class="header">
        <div class="brand">
          <div class="logo-circle">
            <span>S</span>
          </div>
          <div class="title-block">
            <h1>SONIX ‚Äì AI Voice Assistant</h1>
            <p class="subtitle">Hands-free commands, notes & AI answers, just by speaking.</p>
          </div>
        </div>

        <!-- USER PERSONALIZATION -->
        <div class="user-card">
          <small>Hey,</small>
          <input id="userNameInput" type="text" placeholder="your name" />
          <button id="saveNameBtn" class="secondary" style="padding:4px 10px;font-size:11px;">
            Save
          </button>
        </div>
      </div>

      <!-- STATUS + GREETING -->
      <div class="status-row">
        <div class="status-pill">
          Status: <span id="statusText">Idle</span>
        </div>
        <div id="greetingText" class="greeting">
          Hi there üëã I‚Äôm SONIX. Tap ‚ÄúStart Listening‚Äù and talk to me.
        </div>
      </div>

      <!-- CONTROLS -->
      <div class="btn-row">
        <button id="startBtn" class="primary">
          <div id="micDot" class="mic-dot"></div>
          Start Listening
        </button>
        <button id="stopBtn" class="secondary">
          Stop Listening
        </button>
      </div>

      <!-- MAIN PANELS -->
      <div class="panels">
        <!-- LEFT: Conversation -->
        <div class="card">
          <div class="card-header">
            <h2>Conversation with SONIX</h2>
            <small>SONIX understands commands & can answer with AI.</small>
          </div>

          <div class="log-area">
            <div class="log-label">You said:</div>
            <p id="userText" class="log-text user-text">‚Äî</p>

            <div class="log-label" style="margin-top:4px;">SONIX:</div>
            <p id="assistantText" class="log-text assistant-text">
              Waiting for your first command‚Ä¶
            </p>
          </div>

          <div class="help-text">
            <b>Try saying:</b><br />
            <code>open youtube</code>,
            <code>search spring boot tutorial</code>,
            <code>create a note: revise OS</code>,<br />
            <code>show my notes</code>,
            <code>what's the time</code>,
            <code>what's today's date</code><br />
            Or ask anything: <code>explain recursion</code>, <code>give me project ideas</code>, <code>tell me a joke</code>.
          </div>
        </div>

        <!-- RIGHT: Notes -->
        <div class="card">
          <div class="card-header">
            <h2>Your Notes</h2>
            <small>SONIX saves notes in this browser.</small>
          </div>
          <ul id="notesList" class="notes-list"></ul>
        </div>
      </div>

      <div class="footer-line">
        SONIX opens websites in the <b>same tab</b>. AI replies use your OpenAI API key (for demo use only).
      </div>
    </div>
  </div>

 <script>
  /* ---------------- BACKEND URL ---------------- */
  const BASE_URL = "http://localhost:9090/api/notes";

  /* ---------- DOM ELEMENTS ---------- */
  const startBtn = document.getElementById("startBtn");
  const stopBtn = document.getElementById("stopBtn");
  const statusText = document.getElementById("statusText");
  const micDot = document.getElementById("micDot");
  const userTextEl = document.getElementById("userText");
  const assistantTextEl = document.getElementById("assistantText");
  const notesListEl = document.getElementById("notesList");
  const userNameInput = document.getElementById("userNameInput");
  const saveNameBtn = document.getElementById("saveNameBtn");
  const greetingTextEl = document.getElementById("greetingText");

  /* ---------- SPEECH RECOGNITION SETUP ---------- */
  const SpeechRecognition =
    window.SpeechRecognition || window.webkitSpeechRecognition;
  let recognition = null;
  let isListening = false;

  if (!SpeechRecognition) {
    alert("Speech recognition not supported. Use Chrome browser.");
  } else {
    recognition = new SpeechRecognition();
    recognition.continuous = false;
    recognition.interimResults = false;
    recognition.lang = "en-IN";
  }

  /* ---------- TEXT-TO-SPEECH ---------- */
  function speak(text) {
    assistantTextEl.textContent = text;
    const u = new SpeechSynthesisUtterance(text);
    u.lang = "en-IN";
    window.speechSynthesis.cancel();
    window.speechSynthesis.speak(u);
  }

  /* ---------- LISTENING UI ---------- */
  function setListeningState(on) {
    isListening = on;
    if (on) {
      statusText.textContent = "Listening‚Ä¶";
      startBtn.classList.add("listening");
      micDot.classList.add("listening");
      startBtn.innerHTML = '<div class="mic-dot listening"></div>Listening‚Ä¶';
    } else {
      statusText.textContent = "Idle";
      startBtn.classList.remove("listening");
      micDot.classList.remove("listening");
      startBtn.innerHTML = '<div class="mic-dot"></div>Start Listening';
    }
  }

  /* ---------------------------------------------------------
     ---------- BACKEND NOTE FUNCTIONS (CRUD) ----------------
     --------------------------------------------------------- */

  // CREATE NOTE
  async function addNoteToBackend(noteText) {
    try {
      await fetch(BASE_URL, {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({ content: noteText }),
      });

      speak("Note saved.");
      loadNotesFromBackend();
    } catch (err) {
      console.error(err);
      speak("Error saving note.");
    }
  }

  // LOAD NOTES
  async function loadNotesFromBackend() {
    try {
      const res = await fetch(BASE_URL);
      const notes = await res.json();
      renderNotes(notes);
    } catch (err) {
      speak("Could not load notes.");
      console.error(err);
    }
  }

  // DELETE NOTE
  async function deleteNoteFromBackend(id) {
    try {
      await fetch(`${BASE_URL}/${id}`, { method: "DELETE" });
      speak("Note deleted.");
      loadNotesFromBackend();
    } catch (err) {
      speak("Error deleting note.");
      console.error(err);
    }
  }

  /* ---------- RENDER NOTES ---------- */
  function renderNotesBackend(notes) {
  notesListEl.innerHTML = "";

  if (notes.length === 0) {
    const li = document.createElement("li");
    li.innerHTML = `<span class="content" style="color:#6b7280;">No notes yet. Say ‚Äúcreate a note‚Ä¶‚Äù</span>`;
    notesListEl.appendChild(li);
    return;
  }

  notes.forEach((note) => {
    const li = document.createElement("li");

    const span = document.createElement("span");
    span.className = "content";
    span.textContent = note.content;

    const delBtn = document.createElement("button");
    delBtn.textContent = "Delete";
    delBtn.addEventListener("click", () => deleteNoteBackend(note.id));

    li.appendChild(span);
    li.appendChild(delBtn);
    notesListEl.appendChild(li);
  });
}


  /* ---------------------------------------------------------
     ---------- OFFLINE AI (NO API KEY NEEDED) ---------------
     --------------------------------------------------------- */

async function askAI(message) {
    assistantTextEl.textContent = "Thinking‚Ä¶";

    try {
        const response = await fetch("http://localhost:9090/api/ai/ask", {
            method: "POST",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify({ message })
        });

        const data = await response.json();

        const aiReply =
            data.candidates?.[0]?.content?.parts?.[0]?.text ||
            "Sorry, I couldn't understand.";

        speak(aiReply);
        assistantTextEl.textContent = aiReply;

    } catch (error) {
        speak("AI is offline right now.");
        assistantTextEl.textContent = "AI offline.";
    }
}



  /* ---------------------------------------------------------
     ---------- OPEN WEBSITE, SEARCH, TIME, DATE -------------
     --------------------------------------------------------- */

  function openSite(site) {
    const map = {
      youtube: "https://www.youtube.com",
      google: "https://www.google.com",
      github: "https://github.com",
      instagram: "https://www.instagram.com",
      linkedin: "https://www.linkedin.com",
      whatsapp: "https://web.whatsapp.com",
      "chat gpt": "https://chatgpt.com",
    };

    let url = map[site.toLowerCase()] ||
      "https://www.google.com/search?q=" + encodeURIComponent(site);

    speak("Opening " + site);
    window.location.href = url;
  }

  /* ---------------------------------------------------------
     ---------- COMMAND HANDLING ------------------------------
     --------------------------------------------------------- */

  function handleCommand(text) {
    const command = text.toLowerCase().trim();
    userTextEl.textContent = text;

    // OPEN SITE
    if (command.startsWith("open ")) {
      openSite(command.replace("open ", "").trim());
      return;
    }

    // GOOGLE SEARCH
    if (command.startsWith("search ")) {
      const q = command.replace("search ", "").trim();
      speak("Searching " + q);
      window.location.href =
        "https://www.google.com/search?q=" + encodeURIComponent(q);
      return;
    }

    // CREATE NOTE
    // CREATE NOTE (Flexible commands)
if (
  command.startsWith("create a note") ||
  command.startsWith("add a note") ||
  command.startsWith("make a note") ||
  command.startsWith("remember this") ||
  command.startsWith("note that") ||
  command.includes("write a note")
) {

  let noteContent = command
    .replace("create a note", "")
    .replace("add a note", "")
    .replace("make a note", "")
    .replace("remember this", "")
    .replace("note that", "")
    .replace("write a note", "")
    .replace(":", "")
    .trim();

  if (!noteContent) {
    speak("What should I write in your note?");
  } else {
    addNoteBackend(noteContent);
  }
  return;
}

// SHOW NOTES
if (
  command.includes("show my notes") ||
  command.includes("show notes") ||
  command.includes("list my notes")
) {
  speak("Here are your notes.");
  loadNotesBackend();
  return;
}

    // SHOW NOTES
    if (
      command.includes("show my notes") ||
      command.includes("show notes") ||
      command.includes("list my notes")
    ) {
      speak("Fetching your notes.");
      loadNotesFromBackend();
      return;
    }

    // TIME
    if (command.includes("time")) {
      const t = new Date().toLocaleTimeString("en-IN", {
        hour: "2-digit",
        minute: "2-digit",
      });
      speak("The time is " + t);
      return;
    }

    // DATE
    if (command.includes("date")) {
      const d = new Date().toLocaleDateString("en-IN", {
        day: "numeric",
        month: "long",
        year: "numeric",
      });
      speak("Today's date is " + d);
      return;
    }

    // fallback ‚Üí offline AI
    // ASK GEMINI
if (command.startsWith("ask gemini")) {
  const q = command.replace("ask gemini", "").trim();
  if (!q) {
    speak("What should I ask Gemini?");
  } else {
    speak("Opening Gemini with your question.");
    const url =
      "https://gemini.google.com/app?q=" + encodeURIComponent(q);
    window.open(url, "_blank");
  }
  return;
}

// ASK CHATGPT
if (command.startsWith("ask chatgpt") || command.startsWith("ask chat gpt")) {
  const q = command
    .replace("ask chatgpt", "")
    .replace("ask chat gpt", "")
    .trim();
  if (!q) {
    speak("What should I ask ChatGPT?");
  } else {
    speak("Opening ChatGPT with your question.");
    const url =
      "https://chatgpt.com/?q=" + encodeURIComponent(q);
    window.open(url, "_blank");
  }
  return;
}
// ASK GOOGLE
if (command.startsWith("ask google")) {
  const q = command.replace("ask google", "").trim();
  if (!q) {
    speak("What should I ask Google?");
  } else {
    speak("Searching this on Google.");
    window.open("https://www.google.com/search?q=" + encodeURIComponent(q), "_blank");
  }
  return;
}


    askAI(text);
  }

  /* ---------------------------------------------------------
     ---------- SPEECH RECOGNITION EVENTS --------------------
     --------------------------------------------------------- */

  if (recognition) {
    recognition.onstart = () => setListeningState(true);
    recognition.onend = () => setListeningState(false);
    recognition.onerror = () => speak("Please try again.");
    recognition.onresult = (event) =>
      handleCommand(event.results[0][0].transcript);
  }

  startBtn.addEventListener("click", () => {
    recognition.start();
  });

  stopBtn.addEventListener("click", () => {
    recognition.stop();
    speak("Stopped listening.");
  });

  /* ---------------------------------------------------------
     ---------- PERSONALIZATION -------------------------------
     --------------------------------------------------------- */

  function loadUserName() {
    const name = localStorage.getItem("sonix_user_name") || "";
    if (name) {
      userNameInput.value = name;
      greetingTextEl.textContent = `Hi ${name} üëã I'm SONIX.`;
    }
  }

  function saveUserName() {
    const name = userNameInput.value.trim();
    localStorage.setItem("sonix_user_name", name);
    speak(`Nice to meet you, ${name}.`);
  }

  saveNameBtn.onclick = saveUserName;

  /* ---------- INIT ---------- */
  loadUserName();
  loadNotesFromBackend();

  async function addNoteBackend(noteContent) {
  try {
    await fetch("http://localhost:9090/api/notes", {
      method: "POST",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify({ content: noteContent })
    });
    speak("Note added.");
    loadNotesBackend();
  } catch (e) {
    speak("Unable to save the note.");
  }
}

async function loadNotesBackend() {
  try {
    const response = await fetch("http://localhost:9090/api/notes");
    const notes = await response.json();

    // convert to simple content list
    const items = notes.map(n => ({ id: n.id, content: n.content }));
    renderNotesBackend(items);

  } catch (e) {
    speak("Cannot load notes right now.");
  }
}

async function deleteNoteBackend(id) {
  try {
    await fetch("http://localhost:9090/api/notes/" + id, {
      method: "DELETE"
    });
    speak("Note deleted.");
    loadNotesBackend();
  } catch (e) {
    speak("Unable to delete note.");
  }
}

</script>


</body>
</html>


